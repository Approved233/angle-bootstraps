From e08676721de3e9d56bd6f7c78c3f9073f81651a4 Mon Sep 17 00:00:00 2001
From: Ethan Lee <flibitijibibo@gmail.com>
Date: Thu, 2 Jan 2020 12:28:26 -0500
Subject: [PATCH] Fix UWP build

Bug: angleproject:4246
Change-Id: Ifcbb6fe51ee2df6baf86a308de74bab640ded834
---
 .../renderer/d3d/d3d11/renderer11_utils.cpp   | 24 +++++++++++--------
 1 file changed, 14 insertions(+), 10 deletions(-)

diff --git a/src/libANGLE/renderer/d3d/d3d11/renderer11_utils.cpp b/src/libANGLE/renderer/d3d/d3d11/renderer11_utils.cpp
index 0c9698450..df85e9681 100644
--- a/src/libANGLE/renderer/d3d/d3d11/renderer11_utils.cpp
+++ b/src/libANGLE/renderer/d3d/d3d11/renderer11_utils.cpp
@@ -2356,14 +2356,19 @@ void InitializeFeatures(const Renderer11DeviceCaps &deviceCaps,
                         const DXGI_ADAPTER_DESC &adapterDesc,
                         angle::FeaturesD3D *features)
 {
-    bool isNvidia                  = IsNvidia(adapterDesc.VendorId);
-    bool isIntel                   = IsIntel(adapterDesc.VendorId);
-    bool isSkylake                 = false;
-    bool isBroadwell               = false;
-    bool isHaswell                 = false;
-    bool isIvyBridge               = false;
-    bool isAMD                     = IsAMD(adapterDesc.VendorId);
-    bool isFeatureLevel9_3         = (deviceCaps.featureLevel <= D3D_FEATURE_LEVEL_9_3);
+    bool isNvidia          = IsNvidia(adapterDesc.VendorId);
+    bool isIntel           = IsIntel(adapterDesc.VendorId);
+    bool isSkylake         = false;
+    bool isBroadwell       = false;
+    bool isHaswell         = false;
+    bool isIvyBridge       = false;
+    bool isAMD             = IsAMD(adapterDesc.VendorId);
+    bool isFeatureLevel9_3 = (deviceCaps.featureLevel <= D3D_FEATURE_LEVEL_9_3);
+#if defined(ANGLE_ENABLE_WINDOWS_UWP)
+    bool isWin10 = true;
+#else
+    bool isWin10 = IsWindows10OrGreater();
+#endif
     IntelDriverVersion capsVersion = IntelDriverVersion(0);
     if (isIntel)
     {
@@ -2447,8 +2452,7 @@ void InitializeFeatures(const Renderer11DeviceCaps &deviceCaps,
 
     // Don't translate uniform block to StructuredBuffer on Windows 7 and earlier. This is targeted
     // to work around a bug that fails to allocate ShaderResourceView for StructuredBuffer.
-    ANGLE_FEATURE_CONDITION(features, dontTranslateUniformBlockToStructuredBuffer,
-                            !IsWindows10OrGreater());
+    ANGLE_FEATURE_CONDITION(features, dontTranslateUniformBlockToStructuredBuffer, !isWin10);
 
     // Call platform hooks for testing overrides.
     auto *platform = ANGLEPlatformCurrent();
-- 
2.21.0

